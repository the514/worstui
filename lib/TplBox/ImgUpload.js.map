{"version":3,"sources":["../../src/TplBox/ImgUpload.js"],"names":["ImgUpload","props","handleCancel","setState","previewVisible","handlePreview","file","previewImage","url","thumbUrl","handleChange","fileList","event","handleSuccess","result","triggerChange","handleRemove","config","getHeader","thisClass","console","log","uploadImgUrl","uid","delete","then","response","headers","setTokenHeader","openNotification","type","title","body","LoadingEnd","catch","error","status","getAuth","changedValue","onChange","state","undefined","filelistArr","filelist","indexOf","fileUrlArr","split","fileUrlArrLength","length","name","push","uploadButton","copyTips","uploadImgColumnName","width","clear"],"mappings":"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","file":"ImgUpload.js","sourcesContent":["import React, { Component } from 'react';\nimport Global from '../Global';\nimport { Upload, Icon, Modal, Button, Popover } from 'antd';\nimport axios from 'axios';\nimport Config from '../Modules/Config';\n\nclass ImgUpload extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      previewVisible: false,\n      previewImage: '',\n      fileList: []\n    };\n  }\n\n  componentDidMount(props){\n    this.setState({ fileList: [] });\n    // console.log(this.props.fileList);\n    if (this.props.fileList!==null && this.props.fileList !== \"\" && this.props.fileList !== undefined) {\n      if (this.props.fileList !== \"\") {\n        let filelistArr = [];\n        let filelist = {};\n        // console.log(this.props.fileList.split(\"/\"));\n        // console.log(this.props.fileList.split(\"/\").length);\n        if (this.props.fileList.indexOf(\"/\") > 1) {\n          // console.log(\"进到里面\");\n          let fileUrlArr = this.props.fileList.split(\"/\");\n          let fileUrlArrLength = this.props.fileList.split(\"/\").length;\n          // console.log(fileUrlArr[fileUrlArrLength - 2]);\n          filelist.uid = fileUrlArr[fileUrlArrLength - 2];\n          filelist.name = this.props.fileList;\n          filelist.status = \"done\";\n          filelist.url = this.props.fileList;\n\n          filelistArr.push(filelist);\n        }\n\n        // console.log(filelistArr);\n        this.setState({ fileList: filelistArr });\n      }else{\n        this.setState({ fileList: [] });\n      }\n    }else {\n      this.setState({ fileList: [] });\n    }\n  }\n\n  componentWillReceiveProps(props) {\n  }\n\n  handleCancel = () => this.setState({ previewVisible: false })\n\n  handlePreview = (file) => {\n    this.setState({\n      previewImage: file.url || file.thumbUrl,\n      previewVisible: true,\n    });\n  }\n\n  handleChange = ({ file, fileList, event }) => {\n\n    // console.log(file);\n    // console.log(fileList);\n    // console.log(event);\n\n    this.setState({ fileList });\n\n  }\n\n  handleSuccess = (result, file) => {\n    // console.log(result);\n    // console.log(file);\n\n    this.setState({ \n      fileList: [result]\n    });\n    this.triggerChange(result.url);\n  }\n\n  handleRemove = (file) => {\n    // const config = Global.getHeader();\n    const config = Global.getHeader();\n    let thisClass = this;\n    console.log(this.props.url + Config.uploadImgUrl() + \"/\" + file.uid);\n    axios.delete(this.props.url + Config.uploadImgUrl() + \"/\" + file.uid, config)\n      .then(response => {\n        console.log(response.headers);\n        if (response.headers[\"access-token\"]) {\n          Global.setTokenHeader(response);\n        }\n        Global.openNotification({type:\"success\", title:\"操作成功\", body:\"图片已删除。\"});\n        this.triggerChange(\"\");\n        Global.LoadingEnd();\n      })\n      .catch(function (error) {\n        console.log(error);\n        if (error.response.status === 404) {\n          Global.openNotification({type:\"success\", title:\"操作成功\", body:\"图片已删除。\"});\n          thisClass.triggerChange(\"\");\n        }else{\n          Global.openNotification({type:\"error\", title:\"操作失败\", body:\"请求超时，请刷新重试！\"});\n        }\n        Global.getAuth(error);\n        Global.LoadingEnd();\n      });\n  }\n\n  triggerChange = (changedValue) => {\n    // Should provide an event to pass value to Form.\n\n    const onChange = this.props.onChange;\n    if (onChange) {\n      console.log(changedValue);\n      onChange(changedValue);\n    }\n\n  }\n\n  render() {\n    const { previewVisible, previewImage, fileList } = this.state;\n    const uploadButton = (\n      <div>\n        <Icon type=\"plus\" />\n        <div className=\"ant-upload-text\">上传图片</div>\n      </div>\n    );\n    const copyTips = \"复制成功!\";\n\n    return (\n      <div className=\"clearfix\">\n        <Upload\n          name={Config.uploadImgColumnName()}\n          action={this.props.url + Config.uploadImgUrl() + \"/\"}\n          listType=\"picture-card\"\n          defaultFileList={fileList}\n          fileList={fileList}\n          onPreview={this.handlePreview}\n          onChange={this.handleChange}\n          onRemove={this.handleRemove}\n          onSuccess={this.handleSuccess}\n        >\n          {fileList.length >= 1 ? null : uploadButton}\n        </Upload>\n        <Modal\n          wrapClassName=\"vertical-center-modal\"\n          width={\"auto\"}\n          visible={previewVisible} \n          footer={null} \n          onCancel={this.handleCancel}\n        >\n          <img alt=\"img\" style={{ width: '100%' }} src={previewImage} />\n        </Modal>\n        {\n          fileList.length >= 1 &&\n          <div className=\"clearfix\" style={{ clear: 'both', width: '100%' }}>\n            <Popover content={copyTips} title={null} trigger=\"click\">\n              <Button className=\"btnClip\" type=\"primary\" style={{ width: '96px' }} data-clipboard-text={this.props.fileList} ghost>复制链接</Button>\n            </Popover>\n          </div>\n        }\n      </div>\n    );\n  }\n}\n\nexport default ImgUpload;"]}