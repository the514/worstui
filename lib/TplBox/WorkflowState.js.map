{"version":3,"sources":["../../src/TplBox/WorkflowState.js"],"names":["WorkflowState","props","enterIconLoading","e","stateObj","dataId","target","getAttribute","result","tips","thisClass","config","getHeader","params","LoadingStart","put","getUrl","url","then","response","headers","setTokenHeader","status","each","state","k","v","actionValue","button","index","val","action","setState","value","buttonTpl","push","text","stateText","updateList","openNotification","type","title","body","LoadingEnd","catch","error","console","log","getAuth","nextProps","borderBottom","padding","margin"],"mappings":"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","file":"WorkflowState.js","sourcesContent":["import React, { Component } from 'react';\nimport Global from '../Global';\nimport axios from 'axios';\n// import { Button } from 'antd';\nimport $ from 'jquery';\n\nclass WorkflowState extends Component {\n\n  constructor(props) {\n    super(props);\n    // const value = props.value || \"\";\n    this.state={\n    \t// iconLoading: false,\n    \tstateText: '',\n    \tbuttonTpl: [],\n    \tactionValue: null,\n    \tvalue: null\n    }\n  }\n\n  componentDidMount() {\n  \tlet stateObj = this.props.stateObj;\n  \t// let dataId = this.props.dataId;\n  \t// console.log(this.props.actionValue);\n  \t// console.log(this.props.dataId);\n  \t// console.log(this.props.value);\n\n  \tlet actionValue = \"\";\n  \tif (this.props.actionValue) {\n  \t\tactionValue = this.props.actionValue;\n\n\t  \tthis.setState({\n\t  \t\tactionValue: actionValue,\n\t  \t\tvalue: null,\n\t  \t});\n\n  \t}else if (this.props.value) {\n  \t\tactionValue = this.props.value\n\n\t  \tthis.setState({\n\t  \t\tactionValue: null,\n\t  \t\tvalue: this.props.value,\n\t  \t});\n  \t}\n\n  \tlet thisClass = this;\n\n  \t// console.log(actionValue);\n    $.each(stateObj.state, function(k, v) {\n      if (k===actionValue) {\n        // console.log(v.text);\n\n        let buttonTpl = [];\n        $.each(v.button, function(index, val) {\n\n          buttonTpl.push(<button className=\"workflow-button\" key={index} type=\"primary\" data-action={val.action} onClick={thisClass.enterIconLoading}>\n                          {val.text}\n                        </button>);\n        });\n        thisClass.setState({\n          stateText: v.text,\n          buttonTpl: buttonTpl\n        });\n      }\n    });\n\n\n  }\n\n  componentWillReceiveProps(nextProps) {\n  \t// console.log(nextProps);\n\n  \tlet stateObj = nextProps.stateObj;\n  \tlet actionValue = \"\";\n  \t\n\n    if (nextProps.actionValue) {\n\t\t  actionValue = nextProps.actionValue;\n    \n    \tthis.setState({\n    \t\tactionValue: nextProps.actionValue,\n        value: null\n    \t});\n\n    \tlet thisClass = this;\n\n    \t$.each(stateObj.state, function(k, v) {\n    \t\tif (k===actionValue) {\n\n    \t\t\tlet buttonTpl = [];\n  \t\t  \t$.each(v.button, function(index, val) {\n\n  \t\t  \t\tbuttonTpl.push(<button className=\"workflow-button\" key={index} type=\"primary\" data-action={val.action} onClick={thisClass.enterIconLoading}>\n  \t\t\t\t\t\t\t\t\t\t\t\t\t{val.text}\n  \t\t\t\t\t\t\t\t\t\t\t\t</button>);\n  \t\t  \t});\n    \t\t\tthisClass.setState({\n            stateText: v.text,\n    \t\t\t\tbuttonTpl: buttonTpl\n    \t\t\t});\n\n    \t\t}\n    \t});\n    }\n\n  }\n\n  enterIconLoading = (e) => {\n\n  \tlet stateObj = this.props.stateObj;\n  \tlet dataId = this.props.dataId;\n  \tlet target = e.target.getAttribute(\"data-action\");\n  \t// var action = \"\";\n\t\tlet result = \"\";\n\t\tlet tips = \"\";\n  \t// let actionValue = this.props.actionValue;\n  \tlet thisClass = this;\n\n  \tconst config = Global.getHeader();\n\n    // this.setState({ iconLoading: true });\n\n  \tconst params = {};\n\n  \tGlobal.LoadingStart();\n\n    axios.put(Global.getUrl() + stateObj.url + \"/\" + dataId + \"/\" + target, params, config)\n      .then(response => {\n        if (response.headers[\"access-token\"]) {\n          Global.setTokenHeader(response);\n        }\n        // console.log(response);\n        if (response.status === 200) {\n\n\t\t\t  \t$.each(stateObj.state, function(k, v) {\n\t\t\t\t\t\t// console.log(k);\n            if (thisClass.state.actionValue !== null) {\n\n              if (k===thisClass.state.actionValue) {\n\n                $.each(v.button, function(index, val) {\n                  \n                  if( v.button[index].action === target ){\n                    // action = v.button[index].action;\n                    result = v.button[index].result;\n                    thisClass.setState({\n                      actionValue: result,\n                      value: null\n                    });\n                    tips = v.button[index].tips;\n                  }\n\n                });\n              }\n\n            }else{\n\n              if (k===thisClass.state.value) {\n\n                $.each(v.button, function(index, val) {\n                  \n                  if( v.button[index].action === target ){\n                    // action = v.button[index].action;\n                    result = v.button[index].result;\n                    thisClass.setState({\n                      actionValue: null,\n                      value: result\n                    });\n                    tips = v.button[index].tips;\n                  }\n\n                });\n              }\n\n            }\n\n\n\t\t\t  \t});\n\n\t\t\t  \t$.each(stateObj.state, function(k, v) {\n\t\t\t  \t\tif (k===result) {\n\t\t\t  \t\t\t// console.log(v.text);\n\n\t\t\t  \t\t\tlet buttonTpl = [];\n\t\t\t\t\t  \t$.each(v.button, function(index, val) {\n\n\t\t\t\t\t  \t\tbuttonTpl.push(<button className=\"workflow-button\" key={index} type=\"primary\" data-action={val.action} onClick={thisClass.enterIconLoading}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{val.text}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>);\n\t\t\t\t\t  \t});\n\t\t\t  \t\t\tthisClass.setState({\n                stateText: v.text,\n\t\t\t  \t\t\t\tbuttonTpl: buttonTpl\n\t\t\t  \t\t\t});\n\t\t\t  \t\t}\n\t\t\t  \t});\n\n          if (this.props.updateList) {\n            this.props.updateList();\n          }\n\n        }\n        Global.openNotification({type:\"success\", title:\"操作成功\", body: tips});\n        Global.LoadingEnd();\n      })\n      .catch(function (error) {\n        Global.openNotification({type:\"error\", title:\"操作失败\", body:\"请求超时，请刷新重试！\"});\n        console.log(error);\n        Global.getAuth(error);\n        Global.LoadingEnd();\n      });\n  }\n\n  render() {\n    return (\n    \t<div>\n    \t\t<div style={{ borderBottom: '1px #eee solid', padding: '0 0 5px 0', margin: '0 0 5px 0' }}>\n    \t\t\t{this.state.stateText}\n    \t\t</div>\n    \t\t{this.state.buttonTpl}\n\t\t\t</div>\n    );\n  }\n}\n\nexport default WorkflowState;\n"]}