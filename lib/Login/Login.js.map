{"version":3,"sources":["../../src/Login/Login.js"],"names":["LoginTpl","props","divStyle","display","projectCn","title","stateMobile","mobile","statePassword","password","onSubmit","copyright","Login","e","params","account_text","state","password_text","config","headers","console","log","getUrl","loginUrl","LoadingStart","post","then","response","setLoginTokenHeader","LoadingEnd","localStorage","getItem","window","location","href","catch","error","openNotification","type","body","bind","text","document","ready","setTimeout","window_height","height","form_height","css","fadeIn","$this","parents","keydown","event","which","setState","target","value"],"mappings":"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","file":"Login.js","sourcesContent":["import React, { Component } from 'react';\nimport './login.css';\nimport Global from '../Global';\nimport axios from 'axios';\nimport $ from 'jquery';\nimport Config from '../Modules/Config';\n\nfunction LoginTpl (props) {\n\n  const divStyle = {\n    display: 'none'\n  };\n\n  return (\n    <div className=\"sign_in\">\n      <div className='container-fluid'>\n        <h1>{ Config.projectCn().title } · 登录</h1>\n        <div className='sign-in-form'>\n          <div className='sign-in-top'>\n            <div className='border-left'></div>\n            <div className='border-right'></div>\n            <div className='logo'>\n              <img alt='logo' src='/static/images/noavatar.png' />\n            </div>\n          </div>\n          <div className='sign-in-bottom'>\n            <div className='bd'>\n              <div id='alert' style={divStyle}>\n                <i className='fa fa-exclamation-circle'></i>\n                用户名或密码错误\n              </div>\n              <form className=\"new_user\" id=\"new_user\" method=\"post\">\n                <div className='field'>\n                  <i className='fa fa-user'></i>\n                  <input placeholder=\"用户名\" type=\"text\" value={props.stateMobile || ''} name=\"user[login]\" id=\"user_login\" onChange={props.mobile} />\n                </div>\n                <div className='field'>\n                  <i className='fa fa-lock'></i>\n                  <input autoComplete=\"off\" placeholder=\"密码\" value={props.statePassword || ''} type=\"password\" name=\"user[password]\" id=\"user_password\" onChange={props.password} />\n                </div>\n                <div className='actions'>\n                  <input type='button' value='登录' onClick={props.onSubmit} />\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>\n        <div className='copyright'>\n          <p>{ Config.projectCn().copyright }</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nclass Login extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.mobile = this.mobile.bind(this);\n    this.password = this.password.bind(this);\n    this.onSubmit = this.onSubmit.bind(this);\n\n    this.state = {\n      mobile: \"\",\n      password: \"\",\n      headers: {}\n    };\n\n  }\n\n  componentDidMount() {\n    $(\"title\").text( Config.projectCn().title );\n    // const config = {\n    //   headers: {\n    //     // 'Content-type': 'application/json',\n    //     'Accept': 'application/json',\n    //     'access-token': localStorage.getItem(\"admin-access-token\"),\n    //     'client': localStorage.getItem(\"admin-client\"),\n    //     'uid': localStorage.getItem(\"admin-uid\"),\n    //     'expiry': localStorage.getItem(\"admin-expiry\"),\n    //     'token-type': 'Bearer'\n    //   }\n    // };\n\n    // Global.LoadingStart();\n    // axios.get(Global.getUrl() + products_url, config)\n    //   .then(response => {\n    //     console.log(config);\n    //     Global.LoadingEnd();\n    //     window.location.href = \"./\";\n    //   })\n    //   .catch(error => {\n    //     console.log(error);\n    //     // Global.openNotification({type:\"error\", title:\"操作失败\", body:\"请求超时，请刷新重试！\"});\n    //     Global.LoadingEnd();\n    //   });\n\n    $(document).ready(function(){\n      setTimeout((function(){\n        var window_height = $(window).height();\n        var form_height = $(\".sign-in-form\").height();\n        \n        if(window_height > 0){\n          $(\".sign-in-form\").css(\"marginTop\",((window_height-form_height-50)/2)+\"px\").fadeIn();\n        }\n    \n      }),300);\n    });\n\n    var $this = this;\n    $(\".actions\").parents(\"form\").keydown(function(event){ \n      if( event.which === 13 ){\n        $this.onSubmit(event);\n      }\n    });\n  }\n\n  mobile(e){\n    this.setState({mobile: e.target.value});\n  }\n\n  password(e){\n    this.setState({password: e.target.value});\n  }\n\n  onSubmit = (e) => {\n\n    var params = {\n      account_text: this.state.mobile,\n      password_text: this.state.password\n    }\n\n    // const config = Global.getHeader();\n    const config = {\n      headers: {\n        'Content-type': 'application/json',\n        'Accept': 'application/json',\n        'token-type': 'Bearer',\n        'access-token': '',\n        'client': '',\n        'uid': '',\n        'expiry': '',\n      }\n    }\n\n    console.log(Global.getUrl() + Config.loginUrl());\n    \n    Global.LoadingStart();\n    axios.post(Global.getUrl() + Config.loginUrl(), params, config)\n      .then(response => {\n        console.log(response);\n        console.log(response.headers);\n        console.log(config);\n        Global.setLoginTokenHeader(response);\n\n        Global.LoadingEnd();\n        if (localStorage.getItem(\"admin-access-token\")) {\n          window.location.href = \"./\";\n        }\n      })\n      .catch(function (error) {\n        console.log(error);\n        Global.openNotification({type:\"error\", title:\"账号或密码错误\", body:\"请重试登录！\"});\n        Global.LoadingEnd();\n      });\n\n  }\n\n  render() {\n    return (\n      <LoginTpl mobile={this.mobile} password={this.password} stateMobile={this.state.mobile} statePassword={this.state.password} onSubmit={this.onSubmit} />\n    )\n  }\n\n}\n\nexport default Login;\n"]}